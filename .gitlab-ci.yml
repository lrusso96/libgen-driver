image: maven:latest

cache:
  paths:
    - maven.repository/

variables:
  MAVEN_OPTS: "--batch-mode -Dmaven.repo.local=maven.repository -Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=WARN"

buildAndTest:
  script:
    - mvn verify
    # Print "Jacoco-Test-Coverage:xy.z%"
    - cat target/site/jacoco/index.html | grep -o 'Total[^%]*%' | sed -e 's/Total/Jacoco-Test-Coverage:/g'
  artifacts:
    paths:
      - ./.jar
  expire_in: 5min

deployAndMove:
  script:
    - mvn deploy
    - mv target/*.jar .
  artifacts:
    paths:
      - ./.jar
  expire_in: 1d
  only:
    - tags
